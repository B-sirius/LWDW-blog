---
date: 2023-07-04
title: ã€è¯‘ã€‘so, why server components / server componentsæœ‰å•¥å¥½ï¼Ÿ
slug: so-why-server-components
description: Next13å·²ç»åœ¨App Routerä¸­å°†Server Componentä½œä¸ºé»˜è®¤é…ç½®ï¼Œä½†ä½ çœŸçš„äº†è§£å®ƒä¹ˆï¼Ÿè¿™å¯ä¸æ˜¯ä»€ä¹ˆSSRï¼Œå®Œå…¨ä¸åŒï¼Œå¦‚æœä½ å¯¹å…¶æŠ±æœ‰ä¸€ä¸å…´è¶£ä¸ç–‘é—®ï¼Œè¿™ç¯‡è¯‘æ–‡æˆ–è®¸å¯ä»¥ç»™ä½ ä¸€äº›ç­”æ¡ˆã€‚
---

è¯‘è€…ï¼šServer componentsæ˜¯ä¸ªæœ‰è¶£çš„æ¦‚å¿µï¼Œç›®å‰Reactå°†å…¶ä½œä¸ºæœªæ¥å‘å±•çš„é‡ç‚¹æ–¹å‘ï¼Œä¸”Next13ä¹Ÿå°†å…¶ä½œä¸ºApp Routerçš„é»˜è®¤çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥äº†è§£ä¸€ä¸‹è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä½†å®ƒåˆæ˜¯ä¸ªå¾ˆå®¹æ˜“æ··æ·†çš„æ¦‚å¿µï¼Œæ¯”å¦‚æˆ‘ä¸€å¼€å§‹ä»¥ä¸ºè¿™åªæ˜¯SSRæ¢äº†ä¸ªçš®ï¼Ÿåæ¥åˆ™å‘ç°å®Œå…¨ä¸æ˜¯ï¼

æœ¬ç¯‡è¯‘æ–‡ä¼šä»ä¼ ç»Ÿçš„React Client Componentsè®²èµ·ï¼Œä»å®ƒçš„å±€é™å¼•ç”³å‡ºServer componentsæ‰€è¦è§£å†³çš„é—®é¢˜ï¼Œè®©ä½ å¯¹Server componentsçš„åŸç†ä¸ä¼˜åŠ¿æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤çŸ¥ã€‚

ä¸‹é¢å¼€å§‹æ­£æ–‡ï¼ŒåŸæ–‡åœ°å€ï¼š[So, why Server Components](https://blog.jankoritak.com/so-why-server-components)ã€‚ï¼ˆè¯·åŠ¡å¿…çœ‹åˆ°æœ€åï¼Œæˆ‘è¿˜ä¼šåšä¸€äº›è¡¥å……ã€‚ï¼‰

---

## ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦Server Components

å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šèŠèŠæŠŠç»„ä»¶æ”¾åˆ°æœåŠ¡ç«¯ä¼šå‘ç”Ÿä»€ä¹ˆâ€”â€”

ï¼ˆä¸¾æ‰‹ğŸ™‹ï¼‰å‘ƒå‘ƒè¯·ç­‰ä¸‹ï¼Œæ˜¯åŸæ¥çš„ç»„ä»¶ä¸å¤Ÿå¥½å—ï¼Ÿä¸ºå•¥è¦æå‡ºè¿™ç§å¤§èƒ†çš„æƒ³æ³•ï¼Ÿ

å˜›å˜›ï¼Œå†·é™ï¼Œäº‹å®ä¸Šå®¢æˆ·ç«¯ç»„ä»¶éå¸¸é€‚åˆç”¨äºå®ç°**åŠ¨æ€å†…å®¹ï¼Œæˆ–è€…å¼ºäº¤äº’å†…å®¹**ã€‚ä½†æ­£æ‰€è°“äººæ— å®Œäººï¼Œä¼ ç»Ÿçš„å®¢æˆ·ç«¯ç»„ä»¶ä¹Ÿæœ‰å…¶å±€é™ã€‚

## å®¢æˆ·ç«¯ç»„ä»¶çš„å±€é™

### 1. è¿‡é•¿çš„TTLï¼ˆTime to Interactive/é¡µé¢ä»å±•ç¤ºåˆ°å…¶å¯äº¤äº’æ‰€èŠ±çš„æ—¶é—´ï¼‰

è®©æˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹å®¢æˆ·ç«¯æ¸²æŸ“é…åˆSSRæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

1. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è¯·æ±‚é¡µé¢ã€‚
2. æœåŠ¡ç«¯æ‰“åŒ…JSï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªHTMLã€‚
3. æœåŠ¡ç«¯å°†JSåŒ…ä¸HTMLè¿”å›ç»™å®¢æˆ·ç«¯ã€‚
4. å®¢æˆ·ç«¯æ¸²æŸ“HTMLã€‚
5. å®¢æˆ·ç«¯åŠ è½½ã€è§£æã€æ‰§è¡ŒJSã€‚
6. å®¢æˆ·ç«¯è¿›è¡Œhydrateï¼Œé¡µé¢å˜å¾—å¯ä»¥äº¤äº’ã€‚

![image.png](https://s2.loli.net/2023/06/27/rOHMkt6G8xZg7yq.png)

çº¢è‰²çš„æ¨ªçº¿å³TTLæ‰€éœ€è¦çš„æ—¶é—´ã€‚æ˜¾ç„¶ï¼ŒJSåŒ…è¶Šå¤§ï¼Œå®¢æˆ·ç«¯å°±è¦èŠ±æ›´å¤šçš„æ—¶é—´å»åŠ è½½ã€è§£æã€æ‰§è¡Œå®ƒã€‚

### 2. ä¾èµ–è¶Šå¤šï¼ŒJSè¶Šè‡ƒè‚¿

æ˜¾ç„¶ï¼Œä¾èµ–è¶Šå¤šï¼Œé‚£JSåŒ…å°±ä¼šè¶Šå¤§ï¼Œå®¢æˆ·ç«¯å°±è¦èŠ±æ›´å¤šçš„æ—¶é—´å»å¤„ç†å®ƒã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä»£ç ï¼›

è¿™æ®µä»£ç æ¥è‡ª[React Server Component demo Notes app](https://github.com/reactjs/server-components-demo/)ï¼š

```jsx
import {format, isToday} from 'date-fns';
import excerpts from 'excerpts';
import marked from 'marked';

import ClientSidebarNote from './SidebarNote.client';

export default function SidebarNote({note}) {
  const updatedAt = new Date(note.updated_at);
  const lastUpdatedAt = isToday(updatedAt)
    ? format(updatedAt, 'h:mm bb')
    : format(updatedAt, 'M/d/yy');
  const summary = excerpts(marked(note.body), {words: 20});
  return (
    <ClientSidebarNote
      id={note.id}
      title={note.title}
      expandedChildren={
        <p className="sidebar-note-excerpt">{summary || <i>(No content)</i>}</p>
      }>
      <header className="sidebar-note-header">
        <strong>{note.title}</strong>
        <small>{lastUpdatedAt}</small>
      </header>
    </ClientSidebarNote>
  );
}
```

è¿™ä¸ªç»„ä»¶ä¸»è¦å°±æ˜¯å¤„ç†äº†æ—¥æœŸä»¥åŠmarkdownçš„æ˜¾ç¤ºã€‚

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»„ä»¶ç”¨äº†ä¸‰ä¸ªä¾èµ–æ¥å®ç°è¿™äº›åŠŸèƒ½ï¼š`date-fns`ï¼Œ`excerpts`å’Œ`marked`ã€‚å®ƒä»¬çš„å¤§å°æ˜¯gzipå‹ç¼©è¿‡å80KBã€‚ç”±äºå®¢æˆ·ç«¯ç»„ä»¶å¼•å…¥äº†å„ç§ç±»ä¼¼çš„ä¾èµ–ï¼Œä½ çš„JSåŒ…è‚¯å®šä¼šè¶Šæ¥è¶Šå¤§ã€‚

![image.png](https://s2.loli.net/2023/06/27/U7NTAP4vg9tWxlC.png)

### 3. é™·å…¥è¯·æ±‚ç€‘å¸ƒ

ä»¥ä¸Šä¸¤ç‚¹å¯èƒ½ç»™ä½ è¿™æ ·ä¸€ç§é”™è§‰ï¼šå¦‚æœJSæ‰§è¡Œäº†ï¼Œé‚£æˆ‘çš„é¡µé¢åº”è¯¥æ˜¯æ­£å¸¸çš„ï¼Œæœ‰æ„ä¹‰çš„ã€‚

ä½†äº‹å®ä¸Šï¼Œç»å¸¸æœ‰è¿™ç§æƒ…å†µï¼ŒJSæ‰§è¡Œäº†ï¼Œç»“æœç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è¿™æ ·çš„é¡µé¢ï¼š

![image.png](https://s2.loli.net/2023/06/27/qbvj9nQodC3eL5E.png)

è¿™æ˜¯å’‹å›äº‹å‘¢ï¼Ÿæœ‰å¯èƒ½é¡µé¢æ˜¯è¿™æ ·çš„ï¼š

```jsx
import React from 'react';
import Spinner from 'components/Spinner';
import Something from 'components/Something';

const ChildComponentA = () => <Something />

const ChildComponentB = () => {
  // 4. ç»“æœè¿™é‡Œè¿˜éœ€è¦è·å–dataC
  const dataC = useDataC();

  return dataC
    ? <Something />
    : <Spinner />
}

const Root = () => {
  const dataA = useDataA(); // 1. é¦–å…ˆè·å–dataA
  const dataB = useDataB({ skip: !dataA }); // 2. dataAå­˜åœ¨åï¼Œæ‰ä¼šè·å–dataB

  if (!dataA || !dataB) {
    return <Spinner />
  }

  // 3. ç»ˆäºæœ‰äº†dataAä¸dataBï¼Œå¼€å§‹æ¸²æŸ“ä¸œè¥¿äº†
  return (
      <>
        <ChildComponentA data={dataB} />
        <Something />
        <ChildComponentB data={dataB} />
    </>
  )
}
```

çœ‹çœ‹ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™ä¸ªç»„ä»¶éœ€è¦ä¸²è¡Œè¯·æ±‚dataAã€dataBã€dataCã€‚æ‰€ä»¥è¿™ä¸ªç”¨æˆ·ç­‰å¾…çš„æ—¶é—´çœŸçš„å°±æ˜¯é•¿çš„æ²¡è¾¹äº†ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

![image.png](https://s2.loli.net/2023/06/27/JIuxXyvbaA9YFg1.png)

å¾ˆæ˜¾ç„¶è¿™ç§æƒ…å½¢å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºå®¢æˆ·ç«¯å‘åŒä¸€ä¸ªæœåŠ¡ç«¯å‘äº†ä¸‰ä¸ªè¯·æ±‚ï¼Œç„¶åè¿›è¡Œé•¿é•¿çš„ç­‰å¾…ã€‚æœ€è€—æ—¶çš„éƒ¨åˆ†å…¶å®ä¸æ˜¯æœåŠ¡ç«¯çš„å†…éƒ¨äº‹åŠ¡å¤„ç†ï¼ˆæ•°æ®åº“é€šä¿¡ã€å¾®æœåŠ¡è°ƒç”¨ã€è®¿é—®æ–‡ä»¶ç³»ç»Ÿä¹‹ç±»çš„ï¼‰ï¼Œè€Œæ˜¯**å¾€è¿”å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„è·¯ç¨‹**ã€‚ä¸‰æ¬¡ä¸²è¡Œè¯·æ±‚å°±ç­‰äºè¦åœ¨ä¸¤ç«¯å¾€è¿”ä¸‰æ¬¡ã€‚

### 4. æµè§ˆå™¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹

ä¼—æ‰€å‘¨çŸ¥ï¼Œæµè§ˆå™¨çš„JSæ˜¯å•çº¿ç¨‹è¿è¡Œçš„ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬æåˆ°çš„æ‰€æœ‰æ“ä½œéƒ½å‘ç”Ÿå¹¶å †ç§¯åœ¨å•ä¸ªè°ƒç”¨æ ˆå†…ã€‚

### 5. æµè§ˆå™¨æ— æ³•è®¿é—®æœåŠ¡ç«¯API

æ˜¾ç„¶ï¼Œæµè§ˆå™¨å¯ä»¥è®¿é—®æµè§ˆå™¨APIï¼Œæ¯”å¦‚æ“ä½œDOMèŠ‚ç‚¹ï¼Œè°ƒç”¨fetch APIï¼ŒCanvas/WebGLä¹‹ç±»çš„ã€‚è€ŒæœåŠ¡ç«¯å¯ä»¥è®¿é—®ç¯å¢ƒå˜é‡ã€æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ä¹‹ç±»çš„ï¼Œè€Œå®¢æˆ·ç«¯å°±åªèƒ½é€šè¿‡æ¥å£è®¿é—®è¿™äº›æ•°æ®äº†ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹‹æ‰€ä»¥é€šè¿‡REST/GraphQLæ¥å£å»è®¿é—®åç«¯èµ„æºï¼Œè¿˜æ˜¯ä¸ºäº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ä½†æœ‰æ—¶å€™ï¼Œå¦‚æœå¼€å‘è€…å¯ä»¥å¯¹ç³»ç»Ÿå¤šä¸€äº›æ§åˆ¶ï¼Œå¼€å‘ä½“éªŒå°±ä¸Šæ¥äº†ã€‚æ¯”å¦‚å¼€å‘è€…åªèƒ½åœ¨Next.jsçš„æœåŠ¡ç«¯ä»£ç ä¸­è®¿é—®ç¯å¢ƒå˜é‡ï¼Œå¦‚æœä½ æƒ³è¦åœ¨å®¢æˆ·ç«¯ç”¨åˆ°ç¯å¢ƒå˜é‡ï¼ŒNextå¯ä»¥ä½¿ç”¨`NEXT_PUBLIC`å‰ç¼€æ¥è§£å†³ï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦æ³¨æ„ä¸è¦å°†æ•æ„Ÿçš„ä¿¡æ¯æš´éœ²åˆ°å®¢æˆ·ç«¯ã€‚

å¦‚æœèƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯ç›´æ¥è®¿é—®ç¯å¢ƒå˜é‡ï¼Œåˆä¸ç”¨æ‹…å¿ƒå„ç§é™åˆ¶ï¼Œæ˜¯ä¸æ˜¯ä¹ŸæŒºå¥½ï¼Ÿ

## æœåŠ¡ç«¯ç»„ä»¶æ¥äº†ï¼

åœ¨ä¸Šé¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†Reactå®¢æˆ·ç«¯ç»„ä»¶çš„å±€é™ã€‚è¿™äº›å±€é™å¯ä»¥è¯´æ˜¯å®¢æˆ·ç«¯ç¯å¢ƒæœ¬èº«å†³å®šçš„ã€‚

æ‰€ä»¥è®©æˆ‘ä»¬é‡æ–°å®¡è§†è¿™ä»½åˆ—è¡¨ï¼Œçœ‹çœ‹æœåŠ¡ç«¯ç»„ä»¶æ˜¯å¦‚ä½•è§£é™¤è¿™äº›é™åˆ¶å¹¶å¸¦æ¥å„ç§å¯èƒ½æ€§ã€‚

### 1. é•¿æ—¶é—´çš„TTL

å°†ç»„ä»¶æ”¾åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„ä¸€å¤§å¥½å¤„å°±æ˜¯ï¼Œç»„ä»¶JSåŒ…ä¸å†éœ€è¦ä¼ è¾“åˆ°å®¢æˆ·ç«¯äº†ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰1000ä¸ªç»„ä»¶ï¼Œæœ‰500ä¸ªç»„ä»¶æ”¾åœ¨äº†æœåŠ¡ç«¯ï¼Œé‚£ä¹ˆæœ€åéœ€è¦ä¼ é€åˆ°å®¢æˆ·ç«¯çš„JSåŒ…è‚¯å®šä¼šå°å¾ˆå¤šã€‚JSåŒ…å°äº†ï¼Œé‚£å®¢æˆ·ç«¯é¡µé¢çš„åˆå§‹åŒ–é€Ÿåº¦ä¹Ÿå°±å¿«äº†ã€‚

æœåŠ¡ç«¯ç»„ä»¶ä¸ä¼šè¢«åŒ…æ‹¬åœ¨JSåŒ…ä¸­ï¼Œå®ƒä»¬ä¼šåœ¨æœåŠ¡ç«¯è¢«æ¸²æŸ“å¥½ï¼Œå¹¶åºåˆ—åŒ–ä¸ºReactå®˜æ–¹å®šåˆ¶çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚äºæ˜¯React@18/Next.js@13å°±å¯ä»¥é€šè¿‡ç½‘ç»œå°†è¿™äº›å­—ç¬¦ä¸²å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯çš„Reactå°±å¯ä»¥æ ¹æ®è¿™äº›å­—ç¬¦ä¸²è¿›è¡Œç»„ä»¶æ ‘çš„æ›´æ–°ã€‚

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç»„ä»¶æ›´æ–°çš„å®é™…ä¾‹å­ï¼Œæ¥è‡ª[React Server Components demo Notes application](https://github.com/reactjs/server-components-demo/)ï¼š

```json
M1:{"id":"./src/SearchField.client.js","chunks":["client5"],"name":""}
M2:{"id":"./src/EditButton.client.js","chunks":["client1"],"name":""}
S3:"react.suspense"
// J0
J0:["$","div",null,{"className":"main","children":[["$","section",null,{"className":"col sidebar","children":[["$","section",null,{"className":"sidebar-header","children":[["$","img",null,{"className":"logo","src":"logo.svg","width":"22px","height":"20px","alt":"","role":"presentation"}],["$","strong",null,{"children":"React Notes"}]]}],["$","section",null,{"className":"sidebar-menu","role":"menubar","children":[["$","@1",null,{}],["$","@2",null,{"noteId":null,"children":"New"}]]}],["$","nav",null,{"children":["$","$3",null,{"fallback":["$","div",null,{"children":["$","ul",null,{"className":"notes-list skeleton-container","children":[["$","li",null,{"className":"v-stack","children":["$","div",null,{"className":"sidebar-note-list-item skeleton","style":{"height":"5em"}}]}],["$","li",null,{"className":"v-stack","children":["$","div",null,{"className":"sidebar-note-list-item skeleton","style":{"height":"5em"}}]}],["$","li",null,{"className":"v-stack","children":["$","div",null,{"className":"sidebar-note-list-item skeleton","style":{"height":"5em"}}]}]]}]}],"children":"@4"}]}]]}],["$","section","null",{"className":"col note-viewer","children":["$","$3",null,{"fallback":["$","div",null,{"className":"note skeleton-container","role":"progressbar","aria-busy":"true","children":[["$","div",null,{"className":"note-header","children":[["$","div",null,{"className":"note-title skeleton","style":{"height":"3rem","width":"65%","marginInline":"12px 1em"}}],["$","div",null,{"className":"skeleton skeleton--button","style":{"width":"8em","height":"2.5em"}}]]}],["$","div",null,{"className":"note-preview","children":[["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}],["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}],["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}],["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}],["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}]]}]]}],"children":["$","div",null,{"className":"note--empty-state","children":["$","span",null,{"className":"note-text--empty-state","children":"Click a note on the left to view something! ğŸ¥º"}]}]}]}]]}]
// J0ç»“æŸ
M5:{"id":"./src/SidebarNote.client.js","chunks":["client6"],"name":""}
// J4
J4:["$","ul",null,{"className":"notes-list","children":[["$","li","1",{"children":["$","@5",null,{"id":1,"title":"Meeting Notes","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"This is an example note. It contains Markdown!"}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"Meeting Notes"}],["$","small",null,{"children":"12/30/20"}]]}]}]}],["$","li","2",{"children":["$","@5",null,{"id":2,"title":"A note with a very long title because sometimes you need more words","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"You can write all kinds of amazing notes in this app! These note live on the server in the notes..."}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"A note with a very long title because sometimes you need more words"}],["$","small",null,{"children":"12/30/20"}]]}]}]}],["$","li","3",{"children":["$","@5",null,{"id":3,"title":"I wrote this note today","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"It was an excellent note."}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"I wrote this note today"}],["$","small",null,{"children":"12/30/20"}]]}]}]}],["$","li","4",{"children":["$","@5",null,{"id":4,"title":"Make a thing","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"It's very easy to make some words bold and other words italic with Markdown. You can even link to React's..."}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"Make a thing"}],["$","small",null,{"children":"12/30/20"}]]}]}]}],["$","li","6",{"children":["$","@5",null,{"id":6,"title":"Test Noteeeeeeeasd","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"Test note's text"}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"Test Noteeeeeeeasd"}],["$","small",null,{"children":"11/29/22"}]]}]}]}],["$","li","7",{"children":["$","@5",null,{"id":7,"title":"asdasdasd","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"asdasdasd"}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"asdasdasd"}],["$","small",null,{"children":"11/29/22"}]]}]}]}]]}]
// J4ç»“æŸ

```

è¿™ä¸€å¤§å¨ç®€ç›´æ²¡æ³•çœ‹æ˜¯ä¸æ˜¯ï¼äº‹å®ä¸Šè¿™ä»½ç±»ä¼¼JSONçš„æ–‡æœ¬å°±å¯ä»¥æŒ‡å¯¼å®¢æˆ·ç«¯çš„Reactå»æ›´æ–°åº”ç”¨çŠ¶æ€ï¼Œè®©æˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹ã€‚

é¦–å…ˆçœ‹çœ‹æ¯”è¾ƒçŸ­çš„ä¸¤è¡Œï¼š

```json
M1:{"id":"./src/SearchField.client.js","chunks":["client5"],"name":""}
M2:{"id":"./src/EditButton.client.js","chunks":["client1"],"name":""}
M5:{"id":"./src/SidebarNote.client.js","chunks":["client6"],"name":""}
```

ç¬¬ä¸€è¡Œï¼ˆM1ï¼‰å…¶å®å°±æ˜¯æŒ‡å¯¼Reactè¿è¡Œæ—¶æ¸²æŸ“`SearchField`ç»„ä»¶ï¼Œè€Œè¿™ä¸ªç»„ä»¶ä½äºå«åš`client5`çš„æ–‡ä»¶ä¸­ã€‚æ¢å¥è¯æ¥è¯´ï¼Œå®ƒæŒ‡å‘äº†å®¢æˆ·ç«¯ç»„ä»¶ä½äºJSåŒ…ä¸­çš„ä½ç½®ã€‚æ—¢ç„¶è¿™æ˜¯ä¸ªå®¢æˆ·ç«¯ç»„ä»¶ï¼Œæ­¤æ—¶å®ƒè¿˜å°šæœªæ¸²æŸ“ã€‚

React Suspenseè¾¹ç•Œæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå¾ˆç›´æ¥ï¼š

```JSON
S3:"react.suspense"
```

ä¸‹é¢é‡ç‚¹æ¥äº†ï¼Œ`J0`å’Œ`J4`è¿™ä¸¤è¡Œï¼ŒåŒ…å«äº†éå¸¸å¤šçš„å†…å®¹ï¼š

```JSON
// J0
J0:["$","div",null,{"className":"main","children":[["$","section",null,{"className":"col sidebar","children":[["$","section",null,{"className":"sidebar-header","children":[["$","img",null,{"className":"logo","src":"logo.svg","width":"22px","height":"20px","alt":"","role":"presentation"}],["$","strong",null,{"children":"React Notes"}]]}],["$","section",null,{"className":"sidebar-menu","role":"menubar","children":[["$","@1",null,{}],["$","@2",null,{"noteId":null,"children":"New"}]]}],["$","nav",null,{"children":["$","$3",null,{"fallback":["$","div",null,{"children":["$","ul",null,{"className":"notes-list skeleton-container","children":[["$","li",null,{"className":"v-stack","children":["$","div",null,{"className":"sidebar-note-list-item skeleton","style":{"height":"5em"}}]}],["$","li",null,{"className":"v-stack","children":["$","div",null,{"className":"sidebar-note-list-item skeleton","style":{"height":"5em"}}]}],["$","li",null,{"className":"v-stack","children":["$","div",null,{"className":"sidebar-note-list-item skeleton","style":{"height":"5em"}}]}]]}]}],"children":"@4"}]}]]}],["$","section","null",{"className":"col note-viewer","children":["$","$3",null,{"fallback":["$","div",null,{"className":"note skeleton-container","role":"progressbar","aria-busy":"true","children":[["$","div",null,{"className":"note-header","children":[["$","div",null,{"className":"note-title skeleton","style":{"height":"3rem","width":"65%","marginInline":"12px 1em"}}],["$","div",null,{"className":"skeleton skeleton--button","style":{"width":"8em","height":"2.5em"}}]]}],["$","div",null,{"className":"note-preview","children":[["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}],["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}],["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}],["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}],["$","div",null,{"className":"skeleton v-stack","style":{"height":"1.5em"}}]]}]]}],"children":["$","div",null,{"className":"note--empty-state","children":["$","span",null,{"className":"note-text--empty-state","children":"Click a note on the left to view something! ğŸ¥º"}]}]}]}]]}]
// J0ç»“æŸ
// J4
J4:["$","ul",null,{"className":"notes-list","children":[["$","li","1",{"children":["$","@5",null,{"id":1,"title":"Meeting Notes","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"This is an example note. It contains Markdown!"}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"Meeting Notes"}],["$","small",null,{"children":"12/30/20"}]]}]}]}],["$","li","2",{"children":["$","@5",null,{"id":2,"title":"A note with a very long title because sometimes you need more words","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"You can write all kinds of amazing notes in this app! These note live on the server in the notes..."}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"A note with a very long title because sometimes you need more words"}],["$","small",null,{"children":"12/30/20"}]]}]}]}],["$","li","3",{"children":["$","@5",null,{"id":3,"title":"I wrote this note today","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"It was an excellent note."}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"I wrote this note today"}],["$","small",null,{"children":"12/30/20"}]]}]}]}],["$","li","4",{"children":["$","@5",null,{"id":4,"title":"Make a thing","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"It's very easy to make some words bold and other words italic with Markdown. You can even link to React's..."}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"Make a thing"}],["$","small",null,{"children":"12/30/20"}]]}]}]}],["$","li","6",{"children":["$","@5",null,{"id":6,"title":"Test Noteeeeeeeasd","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"Test note's text"}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"Test Noteeeeeeeasd"}],["$","small",null,{"children":"11/29/22"}]]}]}]}],["$","li","7",{"children":["$","@5",null,{"id":7,"title":"asdasdasd","expandedChildren":["$","p",null,{"className":"sidebar-note-excerpt","children":"asdasdasd"}],"children":["$","header",null,{"className":"sidebar-note-header","children":[["$","strong",null,{"children":"asdasdasd"}],["$","small",null,{"children":"11/29/22"}]]}]}]}]]}]
// J4ç»“æŸ
```

`J0`å’Œ`J4`æ˜¯ä¸¤ä¸ªæˆ‘ä»¬ç†ŸçŸ¥çš„åŸºæœ¬ç»„ä»¶`div`å’Œ`ul`ã€‚å®ƒä»¬å·²ç»åœ¨æœåŠ¡ç«¯è¢«æ¸²æŸ“å¥½äº†ï¼Œç„¶ååºåˆ—åŒ–æˆäº†æˆ‘ä»¬çœ‹åˆ°çš„è¿™ç§å­—ç¬¦ä¸²ï¼Œæœ€åå®¢æˆ·ç«¯å°±å¯ä»¥å°†å…¶è½¬æ¢ä¸ºè§†å›¾ã€‚ç‰›çš„åœ°æ–¹å°±åœ¨äºï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦åšä»€ä¹ˆå®é™…çš„å·¥ä½œï¼Œå®ƒåªè¦è§£æå­—ç¬¦ä¸²å¹¶åšæ›´æ–°å°±å¥½äº†ã€‚

äºæ˜¯ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é€šä¿¡å°±å˜æˆäº†è¿™æ ·ï¼š

![image.png](https://s2.loli.net/2023/07/03/rjoIHb2QW1TEhCS.png)

ç»¿è‰²æ¡†æ¡†æ­£æ˜¯RSCå¸¦æ¥çš„æ”¹å˜ï¼Œç›¸æ¯”äºä¹‹å‰ï¼š

- åªæœ‰å®¢æˆ·ç«¯ç»„ä»¶è¢«æ‰“åŒ…åˆ°JSåŒ…ã€‚
- æœåŠ¡ç«¯å°†æœåŠ¡ç«¯ç»„ä»¶æ¸²æŸ“å¹¶åºåˆ—ä¸ºå®šåˆ¶å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯HTMLã€‚
- åœ¨åç»­çš„æœåŠ¡ç«¯ç»„ä»¶æ›´æ–°ä¸­ï¼Œåºåˆ—åŒ–å­—ç¬¦ä¸²ä¼šè¢«å‘é€åˆ°å®¢æˆ·ç«¯ã€‚
- å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®è¿™äº›å­—ç¬¦ä¸²è¿›è¡Œæ›´æ–°å¹¶ç»´æŠ¤çŠ¶æ€ã€‚

æ€»ä¹‹ï¼ŒJSåŒ…å˜å°äº†ï¼ŒTTLä¹Ÿå°±å˜çŸ­äº†ã€‚

### 2. ä¾èµ–ä¸å†å¢åŠ JSåŒ…çš„ä½“ç§¯

æœåŠ¡ç«¯ç»„ä»¶çš„å¦ä¸€å¤§å¥½å¤„å°±æ˜¯å®ƒå¯ä»¥åšåˆ°â€œ0ä½“ç§¯â€ã€‚æ—¢ç„¶ç»„ä»¶æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Œé‚£æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨å®¢æˆ·ç«¯å¼•å…¥ç›¸å…³çš„ä¾èµ–ã€‚

ä»å®ç°çš„è§’åº¦æ¥è®²ï¼Œå½“æœåŠ¡ç«¯çš„React@18å¤„ç†ä¸€ä¸ªæœåŠ¡ç«¯ç»„ä»¶çš„æ—¶å€™ï¼Œå®ƒä¼šå°†å…¶å¤„ç†ä¸ºæœ€ç»ˆåœ¨å®¢æˆ·ç«¯å‘ˆç°çš„åŸºæœ¬ç»„ä»¶ã€‚æ¯”å¦‚ä½ çš„Reactç»„ä»¶ç”¨åˆ°äº†`date-fns/format`å»å¤„ç†æ—¥æœŸï¼Œè¿™äº›å¤„ç†éƒ½å‘ç”Ÿåœ¨æœåŠ¡ç«¯ï¼Œæœ€ç»ˆå‘é€åˆ°å®¢æˆ·ç«¯çš„å·²ç»æ˜¯æœ€åçš„ç»“æœï¼Œå› æ­¤`date-fns/format`ä¾èµ–åœ¨å®¢æˆ·ç«¯æ˜¯ä¸éœ€è¦çš„ã€‚

æ‰€ä»¥ï¼Œåœ¨RSCçš„ä¸–ç•Œä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥å’Œåºå¤§çš„ä¾èµ–è¯´å†è§äº†ã€‚

è¿˜è®°å¾—è¿™å¼ å›¾ä¹ˆï¼Ÿè¿™äº›ä¾èµ–éƒ½ä¸å JSä½“ç§¯äº†ï¼

![image.png](https://s2.loli.net/2023/07/03/p2J61GAdOyMtaoY.png)

### 3. è¯·æ±‚ç€‘å¸ƒæµä¸å†å¾€å¾€å¤å¤

æœåŠ¡ç«¯ç»„ä»¶ç›¸æ¯”äºå®¢æˆ·ç«¯ç»„ä»¶æ›´è´´è¿‘æœåŠ¡ç«¯ç¡¬ä»¶ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼ŒåŸå…ˆéœ€è¦ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡ç«¯çš„è¯·æ±‚ï¼Œç°åœ¨å¯ä»¥å®Œå…¨åœ¨æœåŠ¡ç«¯å†…å®Œæˆã€‚è®©æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹ä¹‹å‰çš„å›¾ï¼š

![image.png](https://s2.loli.net/2023/07/03/jLb8lqy6t1RrANS.png)

æ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯ç°åœ¨åªéœ€è¦å¾€è¿”æœåŠ¡ç«¯ä¸€æ¬¡ï¼Œè€ŒæœåŠ¡ç«¯ç»„ä»¶é—´çš„è¯·æ±‚éƒ½å‘ç”Ÿåœ¨æœåŠ¡ç«¯å†…éƒ¨ï¼Œç›¸æ¯”äºä¹‹å‰ï¼Œè¿™å¯å¿«å¤ªå¤šäº†ï¼

### 4. æœåŠ¡ç«¯ä¸æ­¢ä¸€ä¸ªçº¿ç¨‹

è¿™ä¹Ÿå¾ˆæ˜¾ç„¶ï¼Œæµè§ˆå™¨çš„JSè¿è¡Œæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè€ŒæœåŠ¡ç«¯çš„Node.jså¾€å¾€æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±æœ‰æ›´å¤šçš„å¸¦å®½å¯ä»¥å¤„ç†æœåŠ¡ç«¯ç»„ä»¶äº†ï¼

### 5. æœåŠ¡ç«¯å¯ä»¥è®¿é—®æœåŠ¡ç«¯APIï¼ˆåºŸè¯ï¼‰

å½“æœåŠ¡ç«¯å¤„ç†æœåŠ¡ç«¯ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚ç¯å¢ƒå˜é‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç é‡Œç›´æ¥ä½¿ç”¨`process.env`ï¼Œè¿™è¿˜æŒºçˆ½çš„ä¸æ˜¯ä¹ˆï¼Ÿ

ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥è®¿é—®æœ¬åœ°æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€å¾®æœåŠ¡ã€‚å½“ç„¶ï¼Œç›´æ¥åœ¨ç»„ä»¶ä¸­è®¿é—®æ•°æ®åº“ä¸æ˜¯ä»€ä¹ˆæœ€ä½³å®è·µï¼Œæˆ‘åªæ˜¯ä¸¾ä¸ªä¾‹å­wwã€‚æ¢è¯´ä¸€ä¸ªå®ç”¨çš„ä¾‹å­å§ï¼šåœ¨å®ç°ä¸€ä¸ªé™æ€åšå®¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­ç›´æ¥å¾ªç¯æ–‡ä»¶ç›®å½•ï¼Œè¿‡å»å¯æ˜¯æ²¡æ³•è¿™ä¹ˆå¹²çš„ã€‚

## æ€»ç»“

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†å®¢æˆ·ç«¯ç»„ä»¶çš„5ä¸ªç—›ç‚¹ã€‚æœåŠ¡ç«¯ç»„ä»¶ç»™æˆ‘ä»¬å±•ç°äº†ä¸€ç§å…¨æ–°çš„è§†è§’ï¼Œå¹¶æå‡ºäº†ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚

å¸Œæœ›æœ¬æ–‡å¯ä»¥è®©ä½ å¤§è‡´ç†è§£

1. ä¸ºå•¥React@18è¦è½¬å‘æœåŠ¡ç«¯ç»„ä»¶ã€‚
2. ä¸ºå•¥Next@13è¦å°†æœåŠ¡ç«¯ç»„ä»¶ï¼ˆæ­é…App Routerï¼‰ä½œä¸ºé»˜è®¤é…ç½®ã€‚
3. ä»¥åŠæ€»çš„æ¥è¯´ï¼Œæœªæ¥ä¸€æ®µæ—¶é—´å†…ï¼ŒæœåŠ¡ç«¯ç»„ä»¶ç”Ÿæ€çš„å¯èƒ½å‘å±•æ–¹å‘ã€‚

---

è¯‘è€…ï¼šé‚£ä¹ˆï¼Œè¯‘æ–‡æœ¬ä½“å°±ç»“æŸäº†ï¼Œè¿™ç¯‡æ–‡ç« å¯ä»¥è¯´æ˜¯è®²äº†ä¸€å¤§é€šRSCçš„ä¼˜åŠ¿ï¼Œä½†å¦‚æœå®ƒçœŸçš„é‚£ä¹ˆå‰å®³ï¼Œä¸ºå•¥ç°åœ¨æˆ‘ä»¬ä»ç„¶ç½•è§RSCçš„åº”ç”¨å‘¢ï¼Ÿç™¾é—»ä¸å¦‚ä¸€è¯•ï¼Œç°åœ¨ä½“éªŒRSCæœ‰å‡ ä¸ªå¾ˆå¥½çš„demoï¼š

- [RSC demo](https://stackblitz.com/edit/react-server-components-demo-u57n2t?file=README.md)
- [Next13+RSC demo](https://github.com/vercel/next-react-server-components)

åœ¨ä½“éªŒdemoçš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘è¿™å‡ ä¸ªé—®é¢˜ï¼š

1. RSCåœ¨å®ç°çš„æ—¶å€™ï¼Œç›¸æ¯”å®¢æˆ·ç«¯ç»„ä»¶æœ‰å“ªäº›é™åˆ¶ï¼Ÿ
2. æ€æ ·è§¦å‘RSCçš„ç»„ä»¶çŠ¶æ€æ›´æ–°ï¼Ÿ
3. RSCåœ¨å“ªäº›åœºæ™¯ä¸‹æ¯”è¾ƒé€‚ç”¨ï¼Ÿ
4. ç›¸æ¯”äºSSR+å®¢æˆ·ç«¯ç»„ä»¶ï¼Œå¼•å…¥äº†RSCåï¼Œåˆ°åº•æœ‰å¤šå°‘çš„æ”¹å˜ï¼Ÿ

è¯‘è€…å¯¹äºè¿™äº›é—®é¢˜å…¶å®ä¹Ÿæ²¡æœ‰å¾ˆå¥½çš„ç­”æ¡ˆï¼Œä½†å¦‚æœä½ è¯•ä¸€è¯•ï¼Œä¸€å®šä¼šå‘ç°RSCçš„å®é™…åº”ç”¨æ¯”è¿™ç¯‡æ–‡ç« æ›´åŠ æœ‰è¶£ï¼

**æœ€åæ¨èé˜…è¯»å‡ ç¯‡ç›¸å…³æ–‡ç« ï¼š**

- [Server Components vs. SSR in Next.jsï¼ˆRSC vs SSRï¼‰](https://www.webscope.io/blog/server-components-vs-ssr)
- [I Tested React Server Components And I'm Not A Fan (Yet).ï¼ˆRSCçš„ä¸€äº›é—®é¢˜ï¼‰](https://marmelab.com/blog/2021/06/15/react-server-components.html)
- [Refreshing Server-Side Propsï¼ˆSSRå¹¶ä¸åªæ˜¯è¿”å›HTMLï¼‰](https://www.joshwcomeau.com/nextjs/refreshing-server-side-props/)

